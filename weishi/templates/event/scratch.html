<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content=" initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta name="description" content="刮刮卡">
    <title>刮刮卡</title>
    <link rel="stylesheet" type="text/css" href="{{static_url('css/event/activity.css')}}" media="all">
</head>
<body data-role="page" class="activity-scratch-card-winning">
<script src="http://cdn.staticfile.org/jquery/2.1.1-rc2/jquery.min.js"></script>
<script type="text/javascript">
    function loading(canvas, options) {
        this.canvas = canvas;
        if (options) {
            this.radius = options.radius || 12;
            this.circleLineWidth = options.circleLineWidth || 4;
            this.circleColor = options.circleColor || 'lightgray';
            this.moveArcColor = options.moveArcColor || 'gray';
        } else {
            this.radius = 12;
            this.circelLineWidth = 4;
            this.circleColor = 'lightgray';
            this.moveArcColor = 'gray';
        }
    }
    loading.prototype = {
        show: function () {
            var canvas = this.canvas;
            if (!canvas.getContext) return;
            if (canvas.__loading) return;
            canvas.__loading = this;
            var ctx = canvas.getContext('2d');
            var radius = this.radius;
            var me = this;
            var rotatorAngle = Math.PI * 1.5;
            var step = Math.PI / 6;
            canvas.loadingInterval = setInterval(function () {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                var lineWidth = me.circleLineWidth;
                var center = { x: canvas.width / 2, y: canvas.height / 2 };

                ctx.beginPath();
                ctx.lineWidth = lineWidth;
                ctx.strokeStyle = me.circleColor;
                ctx.arc(center.x, center.y + 20, radius, 0, Math.PI * 2);
                ctx.closePath();
                ctx.stroke();
                //在圆圈上面画小圆
                ctx.beginPath();
                ctx.strokeStyle = me.moveArcColor;
                ctx.arc(center.x, center.y + 20, radius, rotatorAngle, rotatorAngle + Math.PI * .45);
                ctx.stroke();
                rotatorAngle += step;

            }, 100);
        },
        hide: function () {
            var canvas = this.canvas;
            canvas.__loading = false;
            if (canvas.loadingInterval) {
                window.clearInterval(canvas.loadingInterval);
            }
            var ctx = canvas.getContext('2d');
            if (ctx) ctx.clearRect(0, 0, canvas.width, canvas.height);
        }
    };
</script>
<script src="{{static_url('js/wScratchPad.js')}}"></script>
<div class="main">
    <div class="cover">
        <img src="{{static_url('img/event/activity-scratch-card-bannerbg.png')}}">
        <div id="prize"></div>
        <div id="scratchpad"></div>
    </div>
    <div class="content">
        <div id="zjl" style="display: none" class="boxcontent boxwhite">
            <div class="box">
                <div class="title-red"><span>恭喜你中奖了</span></div>
                <div class="Detail">
                    <p>你中了：<span class="red">一等奖</span></p>
                    <p>兑奖SN码：<span class="red" id="Span1">080731995610087932</span></p>
                    <p class="red">请在下方提交你的手机号，方便我们联系你兑奖!兑奖请联系我们，电话18950099999</p>
                    <p class="red">中奖者手机号：144444 </p>
                    <p>
                </div>
            </div>
        </div>
        <div class="boxcontent boxwhite">
            <div class="box">
                <div class="title-red"><span>奖项设置：</span></div>
                <div class="Detail">
                    <p>一等奖： 微官网6折优惠。</p>
                    <p>二等奖： 微官网8折优惠。</p>
                    <p>三等奖： 微官网9折优惠。</p>
                </div>
            </div>
        </div>
        <div class="boxcontent boxwhite">
            <div class="box">
                <div class="title-red">活动说明：</div>
                <div class="Detail">
                    <p class="red">本次活动总共可以刮2次,你已经刮了2次,机会如果没用完重新进入本页面可以再刮! 如果已中奖，则不可再刮！</p>
                    <p>亲，请点击进入刮刮奖活动页面，祝您好运哦！ </p>
                </div>
            </div>
        </div>
    </div>
    <div style="clear: both;"></div>
</div>
<script type="text/javascript">
    var zjl = false;//没中奖为false中奖为true
    var num = 0;
    var goon = true;
    $(function () {
        var useragent = window.navigator.userAgent.toLowerCase();
        $("#scratchpad").wScratchPad({
            width: 150,
            height: 40,
            color: "#a9a9a7",
            scratchMove: function () {
                num++;
                if (!zjl && num == 2) {
                    document.getElementById('prize').innerHTML = "谢谢参与";
                }
                if (zjl && num > 5 && goon) {
                    goon = false;
                    $("#zjl").slideToggle(500);
                }
                if (useragent.indexOf("android 4") > 0) {
                    if ($("#scratchpad").css("color").indexOf("51") > 0) {
                        $("#scratchpad").css("color", "rgb(50,50,50)");
                    } else if ($("#scratchpad").css("color").indexOf("50") > 0) {
                        $("#scratchpad").css("color", "rgb(51,51,51)");
                    }
                }

            }
        });
    });

    $("#save-btn").bind("click",
            function () {
                var btn = $(this);
                var tel = $("#tel").val();
                if (tel == '') {
                    alert("请输入手机号");
                    return
                }

                var submitData = {
                    id: 10135,
                    code: $("#sncode").text(),
                    tel: tel,
                    tel_rename: '手机号',
                    sdid: 17257,
                    fromUsername: 'o-pbztxCqi44pjVEILVcPP8cskX0',
                    tk: '4a12207616277f4cc516383a02e07870'
                };
                $.post('/activity/AddCard', submitData,
                        function (data) {
                            if (data.success == true) {
                                alert(data.msg);
                                return
                            } else {
                            }
                        },
                        "json")
            });

    $("#save-btnn").bind("click",
            function () {
                //var btn = $(this);
                var submitData = {
                    id: 10135,
                    code: $("#sncode").text(),
                    sdid: 17257,
                    parssword: $("#parssword").val(),
                    Confirm_pwd: '',
                    fromUsername: 'o-pbztxCqi44pjVEILVcPP8cskX0',
                    tk: '4a12207616277f4cc516383a02e07870'
                };
                $.post('/activity/AddCard', submitData,
                        function (data) {
                            if (data.success == true) {
                                alert(data.msg);
                                if (data.changed == true) {
                                    window.location.href = location.href;
                                }
                                return
                            } else {
                            }
                        },
                        "json")
            });
    document.addEventListener('WeixinJSBridgeReady', function onBridgeReady() {
        window.shareData = {
            "imgUrl": "http://stc.weimob.com/img/web_bb/activity/activity-scratch-card-start.jpg",
            "timeLineLink": "http://www.weimob.com/activity/ScratchCard?id=10135&bid=17257&pid=18692&wechatid=fromUsername&v=4a12207616277f4cc516383a02e07870",
            "sendFriendLink": "http://www.weimob.com/activity/ScratchCard?id=10135&bid=17257&pid=18692&wechatid=fromUsername&v=4a12207616277f4cc516383a02e07870",
            "weiboLink": "http://www.weimob.com/activity/ScratchCard?id=10135&bid=17257&pid=18692&wechatid=fromUsername&v=4a12207616277f4cc516383a02e07870",
            "tTitle": "刮刮卡活动开始了",
            "tContent": "亲，请点击进入刮刮卡页面，快来参加活动吧！~",
            "fTitle": "刮刮卡活动开始了",
            "fContent": "亲，请点击进入刮刮卡页面，快来参加活动吧！~",
            "wContent": "亲，请点击进入刮刮卡页面，快来参加活动吧！~"
        };
        // 发送给好友
        WeixinJSBridge.on('menu:share:appmessage', function (argv) {
            WeixinJSBridge.invoke('sendAppMessage', {
                "img_url": window.shareData.imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": window.shareData.sendFriendLink,
                "desc": window.shareData.fContent,
                "title": window.shareData.fTitle
            }, function (res) {
                _report('send_msg', res.err_msg);
            })
        });

        // 分享到朋友圈
        WeixinJSBridge.on('menu:share:timeline', function (argv) {
            WeixinJSBridge.invoke('shareTimeline', {
                "img_url": window.shareData.imgUrl,
                "img_width": "640",
                "img_height": "640",
                "link": window.shareData.timeLineLink,
                "desc": window.shareData.tContent,
                "title": window.shareData.tTitle
            }, function (res) {
                _report('timeline', res.err_msg);
            });
        });

        // 分享到微博
        WeixinJSBridge.on('menu:share:weibo', function (argv) {
            WeixinJSBridge.invoke('shareWeibo', {
                "content": window.shareData.wContent,
                "url": window.shareData.weiboLink,
            }, function (res) {
                _report('weibo', res.err_msg);
            });
        });
    }, false)
</script>

</body>
</html>